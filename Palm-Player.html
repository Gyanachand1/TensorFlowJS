
<html>

	<head>

		<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
		<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>
		<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/handpose"></script>

	</head>

	<body>
		<video width=640 height=480 autoplay muted id="camera">
		</video>

		<canvas width=640 height=480 id="augmented_palm"> </canvas>

		<video autoplay muted loop id="movie" style="visibility: hidden">
			<source src="frozen.mp4" type="video/mp4"> </source>
		</video>

		<script>

			// captures the position of the hand in live camera stream
			// and plays video on palm
			async function capture_hand()
			{
				// load camera stream
				const frame = document.getElementById("camera");

				// load movie stream
				const movie = document.getElementById("movie");
				movie.play();

				// prepare canvas
				const canvas = document.getElementById("augmented_palm");
				const draw = canvas.getContext("2d");

				// load hand-pose model
				const model = await handpose.load();

				// fill canvas with camera frame
				draw.drawImage(frame, 0, 0, width=640, height=480);

				// running the hand-pose model
				const result = await model.estimateHands(frame);

				if(result.length > 0)
				{
					// get hand co-ordinates
					const hand = result[0];

					// get thumb position
					const thumb = hand.annotations.thumb;

					const thumb_x = Math.round(thumb[0][0]);
					const thumb_y = Math.round(thumb[0][1]);

					// get pinky position
					const pinky = hand.annotations.pinky;

					const pinky_x = Math.round(pinky[0][0]);
					const pinky_y = Math.round(pinky[0][1]);

					const x = Math.min(thumb_x, pinky_x);
					const y = Math.min(thumb_y, pinky_y);
					const w = Math.abs(thumb_x - pinky_x);
					const h = Math.abs(thumb_y - pinky_y);

					draw.drawImage(movie, x-20, y-20, w+20, h+20);
				}

				// loop to process the next frame
				setTimeout(capture_hand, 1000/15);
			}

		</script>

		<script>

		function live_webcam()
		{
			// capture live video stream from web camera
			if(navigator.mediaDevices.getUserMedia)
			{
				navigator.mediaDevices.getUserMedia({video: true})
					.then(function (stream) {video.srcObject = stream; });
			}
		}

		function main()
		{
			// check if the video is loaded and ready for processing
			video = document.getElementById("camera");
			if(video.readyState == 4)
			{
				console.log("video is ready for processing..");
				capture_hand();
			}
			else
			{
				console.log("nope, not ready yet..");
				setTimeout(main, 1000/30);
			}
		}

		// capture live stream
		live_webcam();

		// run augmentation once the video is ready
		main();

	  </script>

	</body>
</html>
